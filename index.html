<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Liam Bachelor Thesis</title>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      font-size: 20px;
      text-align: center;
      margin-top: 100px;
      margin-left: 300px;
      margin-right: 300px;
    }

    button {
      padding: 12px 20px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 20px;
    }
  </style>
</head>

<body>

  <p id="before-text">
    Hi, my name is Liam! I am currently writing my bachelor thesis in the study course
    Animation & Game at the University of Applied Sciences Darmstadt.
    Thank you for helping out!
  </p>

  <p>
    The total gameplay time is around 5–7 minutes, followed by a questionnaire.
    Click the button to start testing!
  </p>

  <button onclick="assignGroup()">Get me testing!</button>

  <div id="result" style="margin-top: 20px;"></div>

  <script>
    const supabaseUrl = "https://nxpbqfrfyhsreyjnzwhn.supabase.co";
    const supabaseKey = "PASTE_YOUR_REAL_ANON_KEY_HERE";

    const supabase = window.supabase.createClient(
      supabaseUrl,
      supabaseKey
    );

    async function assignGroup() {

      // Prevent duplicate participation
      const existingGroup = localStorage.getItem("group");
      if (existingGroup) {
        document.getElementById("result").innerHTML =
          `<p>You were already assigned to <strong>Group ${existingGroup}</strong>.</p>`;
        return;
      }

      // Get current counts
      const { data, error } = await supabase
        .from("participants")
        .select("group_assignment");

      if (error) {
        alert("Error fetching group counts");
        console.error(error);
        return;
      }

      const countA = data.filter(p => p.group_assignment === "A").length;
      const countB = data.filter(p => p.group_assignment === "B").length;

      // Assign to smaller group
      const group = countA <= countB ? "A" : "B";

      // Insert participant
      const { error: insertError } = await supabase
        .from("participants")
        .insert({ group_assignment: group });

      if (insertError) {
        alert("Error saving assignment");
        console.error(insertError);
        return;
      }

      localStorage.setItem("group", group);

      document.getElementById("result").innerHTML =
        `<p>You have been assigned to <strong>Group ${group}</strong>.</p>`;
    }
  </script>

</body>
</html>
